services:
  # Frontend React
  frontend:
    build:
      context: .
      dockerfile: Dockerfile  # Dockerfile ·ªü root c·ªßa Frontend repository
      args:
        # ‚úÖ Set empty string ƒë·ªÉ frontend d√πng relative path (same origin)
        # V·ªõi Cloudflare Tunnel, frontend v√† backend c√πng domain https://qlcvtagtech.com
        # Nginx s·∫Ω proxy /api v√† /ws ƒë·∫øn backend container
        VITE_API_URL: ""
        VITE_NOTIFICATION_STOMP_URL: ""  # Empty = d√πng relative path /ws (code c√≥ fallback)
        VITE_LOGOUT_URL: "/api/v1/auth/logout"  # Relative path (code kh√¥ng c√≥ fallback)
    container_name: tagweb_frontend
    restart: unless-stopped
    ports:
      - "80:80"
      # üîí SECURITY: Kh√¥ng expose 443 trong container
      # SSL n√™n ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi reverse proxy (Nginx host / Traefik) ·ªü ngo√†i
      # - "443:443"
    environment:
      TZ: Asia/Ho_Chi_Minh  # ‚è∞ Timezone Vi·ªát Nam
      # ‚ö†Ô∏è L∆ØU √ù: BACKEND_API_URL trong Nginx l√† BUILD-TIME, kh√¥ng ph·∫£i runtime
      # N·∫øu ƒë·ªïi backend URL ‚Üí c·∫ßn rebuild frontend image
      # Backend API URL - c√≥ th·ªÉ d√πng service name ho·∫∑c external URL
      # N·∫øu backend trong c√πng Docker network ‚Üí d√πng service name
      # N·∫øu backend ·ªü ngo√†i ‚Üí d√πng URL (http://your-server-ip:8080)
      BACKEND_API_URL: http://backend:8080
    # üìù Log rotation ƒë·ªÉ tr√°nh ƒë·∫ßy ·ªï c·ª©ng
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - tagweb_shared_network  # Connect v√†o network chung v·ªõi Backend

networks:
  tagweb_shared_network:
    name: tagweb_shared_network
    external: true  # Network ƒë√£ ƒë∆∞·ª£c t·∫°o b·ªüi Backend ho·∫∑c t·∫°o th·ªß c√¥ng

